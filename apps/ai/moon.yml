$schema: 'https://moonrepo.dev/schemas/project.json'

language: 'python'

project:
  name: 'ai'
  description: 'AI service for Ascension'

tasks:
  setup:
    command: 'python'
    args: ['-m', 'venv', 'venv']
    inputs:
      - 'pyproject.toml'
    outputs:
      - 'venv'

  install:
    command: 'venv/bin/pip'
    args: ['install', '-e', '.[dev]']
    inputs:
      - 'pyproject.toml'
    outputs:
      - 'venv'
    deps:
      - 'setup'

  dev:
    command: 'venv/bin/python'
    args: ['consumer.py']
    deps:
      - 'install'
    env:
      LOG_LEVEL: 'debug'
      PYTHONUNBUFFERED: '1'
    options:
      envFile: true

  build:
    command: 'venv/bin/python'
    args: ['-m', 'build']
    deps:
      - 'install'

  lint:
    command: 'venv/bin/ruff'
    args: ['check', '.']
    deps:
      - 'install'

  test:
    command: 'venv/bin/pytest'
    args: ['--ignore=venv', '-p', 'no:cacheprovider']
    deps:
      - 'install'
    options:
      allowFailure: true
